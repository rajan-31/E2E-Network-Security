- name: Create Kubernetes Secret for backend from Vault
  k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: backend-secret
        namespace: default 
      type: Opaque
      stringData: "{{ env_vars }}"

- name: Apply Kubernetes deployment
  k8s:
    state: present
    src: deployment.yaml
    namespace: default

- name: Force rollout restart for backend deployment
  command: kubectl rollout restart deployment/backend-deployment -n default

- name: Force rollout restart for frontend deployment
  command: kubectl rollout restart deployment/frontend-deployment -n default

- name: Apply Kubernetes Ingress
  k8s:
    state: present
    src: ingress.yaml
    namespace: default